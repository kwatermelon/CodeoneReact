import React, { useEffect, useState } from "react";
import axios from "axios";
import { useParams } from "react-router-dom";
import { CopyToClipboard } from "react-copy-to-clipboard"; // ë§í¬ë³µì‚¬ ë¼ì´ë¸ŒëŸ¬ë¦¬

import "./css/jobdetail.css";
import Jobkakaomap from "./Jobkakaomap";
import Jobkakaomsg from "./jobkakaomsg";
import Buttons from "./Buttons";
import { useNavigate } from "react-router-dom";
import company from "../../assets/job/company.png";
import download from "../../assets/job/download.png";
import gmail from "../../assets/job/gmail.png";
import date from "../../assets/job/date.png";
import location from "../../assets/job/location.png";
import link from "../../assets/job/link.png";
import upup from "../../assets/job/upup.png";

function Jobdetail() {
    const [item, setItem] = useState({}); // ê°ì²´ë¡œ ì´ˆê¸°í™”í•´ì£¼ê¸°
    const [isLoggedIn, setIsLoggedIn] = useState(false); // ë¡œê·¸ì¸ ì—¬ë¶€ ì´ˆê¸°í™”
    const [comfile, setComfile] = useState("");

    let params = useParams(); // seqê°’ ë°›ì•„ì˜¤ê¸°
    let seq = params.seq;

    let history = useNavigate();

    function handleClick() {
        history("/JobMail");
    }

    //ê¸€ëª©ë¡ ê°€ì§€ê³  ì˜¤ê¸°
    const jobData = async (seq) => {
        await axios
            .get("http://localhost/job/view", { params: { seq: seq } })
            .then(function (resp) {
                console.log(resp.data.view.view);
                setItem(resp.data.view.view); // item ë„£ì–´ì£¼ê¸°
            })
            .catch(function (err) {
                console.log(err);
            });
    };
    // let params = useParams(); //memberseqê°’ ë°›ì•„ì˜¤ê¸°
    // let memberseq = params.memberseq;

    //ë‹¤ìš´ë¡œë“œ
    // ë‹¤ìš´ë¡œë“œ ë²„íŠ¼ í´ë¦­ ì‹œ ì‹¤í–‰ë˜ëŠ” í•¨ìˆ˜
    const handleDownload = () => {
        // GET ìš”ì²­ ë³´ë‚´ê¸°
        axios
            .get(`http://localhost:80/downloadFile?fileName=${item.comfile}`, {
                responseType: "blob",
            })
            .then((res) => {
                // ë‹¤ìš´ë¡œë“œ ìˆ˜í–‰
                const url = window.URL.createObjectURL(new Blob([res.data]));
                const link = document.createElement("a");
                link.href = url;
                link.setAttribute("download", item.comfile);
                document.body.appendChild(link);
                link.click();
            })
            .catch((err) => console.log(err));
    };

    useEffect(() => {
        // initialize ìš©ë„
        jobData(seq);
    }, [seq]);

    //í™•ì¸ìš© ì½˜ì†”
    // console.log(item.commapx);
    // console.log(item.commapy);

    // console.log(`jobdetail/${seq}`);

    function scrollToTop() {
        window.scrollTo({
            top: 0,
            behavior: "smooth",
        });
    }

    const buttons1 = [
        { to: "/joblist", label: "ì±„ìš©ê³µê³ " },
        { to: "/jobcalendar", label: "ì±„ìš©ì¼ì •" },
    ];
    const buttons2 = [{ to: "/registration", label: "ê¸°ì—…íšŒì›" }];

    //ë§í¬ ë³µì‚¬
    const currentUrl = window.location.href;

    const handleCopyToClipboard = () => {
        alert("ë§í¬ê°€ ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤.");
    };

    

    return (
        <>
            <div className="buttons-container">
                <Buttons buttons={buttons1} />
                <Buttons buttons={buttons2} />
            </div>
            <div className="job-detail">
                {/* íšŒì‚¬ì´ë¦„ */}
                <span id="jobname">
                    {" "}
                    <img src={company} alt="company" className="job-company" />
                    {item.comname}
                </span>{" "}
                &nbsp;
                {/* ì±„ìš© ì „í˜•+ê¸°ìˆ +ë³µì§€ */}
                <div className="job-tag">
                    <p id="comjobname">ğŸ™{item.comjobname}</p>
                    <span>ğŸ’™{item.comskill}</span>{" "}
                    <span id="tagline">ğŸ’™{item.comtag}</span> <br />
                </div>
                {/* ì‹œì‘ì¼ ~ ë§ˆê°ì¼ */}
                <p id="startdead">
                    <img src={date} alt="date" className="job-start" />
                    &nbsp;
                    {item.startline} ~ {item.deadline}
                </p>
                {/* ê²Œì‹œê¸€ ì‚¬ì§„ + ë‚´ìš© */}
                <div className="content-container">
                    <div className="content-line"></div>
                    <br />
                    <div dangerouslySetInnerHTML={{ __html: item.content }} />
                    <br />
                </div>
                {/* íšŒì‚¬ ìœ„ì¹˜ ì¹´ì¹´ì˜¤ë§µ API */}
                <div className="location-container">
                    <div className="location-line"></div>
                    <h4>
                        {" "}
                        <img
                            src={location}
                            alt="findjob"
                            className="job-down"
                        />
                        íšŒì‚¬ ìœ„ì¹˜
                    </h4>
                    <br />
                    <Jobkakaomap
                        comname={item.comname}
                        latitude={item.commapx}
                        longitude={item.commapy}
                    />
                </div>
                <br />
                <br />
                {/* ì´ë ¥ì„œ ë‹¤ìš´ë¡œë“œ */}
                <div className="download-container">
                    <div className="download-line"></div>
                    <span>[{item.comname}]ì˜ ì´ë ¥ì„œ ë‹¤ìš´ë¡œë“œí•˜ê¸°</span>
                    {/* ì´ë ¥ì„œ ë‹¤ìš´ë¡œë“œ ë²„íŠ¼ */}
                    <button id="down" onClick={handleDownload}>
                        <img
                            src={download}
                            alt="findjob"
                            className="job-down"
                        />
                    </button>
                </div>
                <br />
                <br />
                <div className="jobQNA">
                    <div className="qna-line"></div>
                    <span>
                        [{item.comname}] ë‹´ë‹¹ìì—ê²Œ ë¬¸ì˜í•˜ê¸° &nbsp;
                        <img src={gmail} alt="findjob" className="job-qna" />
                        &nbsp;
                    </span>
                    <span>
                        <a
                            href={`mailto:${item.comEmail}?subject=CodeOne:ë¬¸ì˜ë“œë¦½ë‹ˆë‹¤&body=ì‚¬ìš©ì id :%0D%0A%0D%0Aì‚¬ìš©ì ì´ë¦„ :%0D%0A%0D%0Aë¬¸ì˜ë‚´ì—­ :`}
                            target="_blank"
                            rel="noopener noreferrer"
                        >
                            Contact Us
                        </a>
                    </span>
                </div>
                <br />
                <br />
            </div>
            <br />
            <br />
            {/* ì˜¤ë¥¸ìª½ nav */}
            <div className="job-nav">
                <p id="jobnav">
                    {item.comname} <br />
                    {item.comjobname}
                </p>
                <p>ê²½ë ¥: {item.comcareer}</p>
                <p>ì—°ë´‰ : {item.comsalary}</p>
                <p>ë§ˆê°ì¼ : {item.deadline}</p>
                <div>
                    <a href={`/jobMail/${item.seq}`}>
                        <button className="regi-button" onClick={handleClick}>
                            ì§€ì›í•˜ê¸°
                        </button>
                    </a>
                </div>
                <div></div>
                {/* ì¹´ì¹´ì˜¤í†¡ ê³µìœ  ë©”ì‹œì§€ ë³´ë‚´ê¸° */}
                <div className="job-msg">
                    <Jobkakaomsg link={`/jobdetail/${seq}`} />
                </div>

                {/* ê³µìœ  ë§í¬ ë³µì‚¬  */}
                <div className="job-link">
                    <CopyToClipboard
                        text={currentUrl}
                        onCopy={handleCopyToClipboard}
                    >
                        <img
                            src={link}
                            alt="link"
                            className="job-link"
                            style={{ cursor: "pointer" }}
                        />
                    </CopyToClipboard>
                </div>
            </div>

            <div className="job-up">
                <img
                    src={upup}
                    alt="up"
                    className="job-upup"
                    onClick={scrollToTop}
                    style={{ cursor: "pointer" }}
                />
            </div>
        </>
    );
}

export default Jobdetail;
