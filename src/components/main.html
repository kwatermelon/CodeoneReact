import React, { useEffect, useState } from "react";
import { Card, Button } from "react-bootstrap";
import styled from "styled-components";
import axios from "axios";
import imageDefault from "../assets/blog/imageDefault.png";
import visibility from "../assets/blog/visibility.png";

import favorite from "../assets/blog/favorite.png";
import BlogCard from "./blog/BlogCard";
import Chatbox from "./main/Chatbox";
import "./Main.css";

import { Swiper, SwiperSlide } from "swiper/react"; // basic
import SwiperCore, { Navigation, Pagination } from "swiper";
// Import Swiper styles
import 'swiper/css';
import 'swiper/css/navigation';
import 'swiper/css/pagination';
import 'swiper/css/scrollbar';
import banner1 from '../assets/main/banner1.jpg';
import banner2 from '../assets/main/banner2.jpg';
import banner3 from '../assets/main/banner3.jpg';
import job1 from '../assets/main/home.png';
import job2 from '../assets/main/money.png';
import job3 from '../assets/main/time.png';
import job4 from '../assets/main/wallet.png';

const TabMenu = styled.ul`
  background-color: #dcdcdc;
  color: rgb(232, 234, 237);
  font-weight: bold;
  display: flex;
  flex-direction: row;
  align-items: center;
  list-style: none;
  margin-bottom: 7rem;
  margin-top: 10px;

  .submenu {
  // ê¸°ë³¸ Tabmenu ì— ëŒ€í•œ CSSë¥¼ êµ¬í˜„
    display: flex;
    /* justify-content: space-between;
    width: 380px;
    heigth: 30px; */
    width: calc(100% /3);
    padding: 10px;
    font-size: 15px;
    transition: 0.5s;
    border-radius: 10px 10px 0px 0px;
  }

  .focused {
   //ì„ íƒëœ Tabmenu ì—ë§Œ ì ìš©ë˜ëŠ” CSSë¥¼ êµ¬í˜„
    background-color: rgb(255,255,255);
    color: rgb(21,20,20);
  }

  & div.desc {
    text-align: center;
  }
`;

const Desc = styled.div`
  text-align: center;
`;

const ColoredText = styled.span`
    color: #e6b74a;
`;

const SearchResultContainer = styled.div`
    //   display: flex;
    width: 100%;
    height: 3000px;
    margin: 0 auto;
    justify-content: center;
`;
//ì±„ìš©
const ChatboxContainer = styled.div`
    position: fixed;
    bottom: 20px;
    right: 20px;
    /* ì¶”ê°€ì ì¸ ìŠ¤íƒ€ì¼ ì†ì„±ì€ í•„ìš”ì— ë”°ë¼ ì¶”ê°€í•©ë‹ˆë‹¤ */
`;

const Main = () => {
    const [blogList, setBlogList] = useState([]);

    // ë¸”ë¡œê·¸ ê°€ì ¸ì˜¤ê¸°
    const getAllBlogs = async () => {
        const res = await axios({
            method: "get",
            url: "http://localhost:/blog/getAllBlogs", // => url ë§ëŠ”ê±°ë¡œ ë°”ê¾¸ê¸°
            headers: {
                "Content-Type": "multipart/form-data",
            },
        });
        setBlogList(res.data);
    };

    const printRows = (blogList) => {
        console.log(blogList.length);
        let roofAmount = parseInt(blogList.length / 5) + 1;

        let components = [];

        for (let i = 0; i < 5; i++) {
            let component = (
                <div key={i} className="row">
                    <Row blogList={blogList} start={i * 5} />
                </div>
            );

            components.push(component);
        }

        return components;
    };

    const readBlog = (seq) => {
        window.location.href = `/blogReadForm/${seq}`;
    };

    const Row = (props) => {
        let blogList = props.blogList;
        let start = props.start;
        let end = start + 5;
        if (blogList.length < end) {
            end = blogList.length;
        }

        let components = [];

        while (start < end) {
            let blog = blogList[start++];
            let seq = blog.seq;
            let title = blog.title;
            let writer = blog.writer;
            let thumbnail = imageDefault;
            if (blog.thumbnail) {
                thumbnail = blog.thumbnail;
            }
            let likes = blog.likes;
            let replies = blog.replies;


            let component = (
                <BlogCard
                    key={seq}
                    seq={seq}
                    title={title}
                    thumbnail={thumbnail}
                    likes={likes}
                    replies={replies}
                    writer={writer}
                ></BlogCard>
            );

            components.push(component);
        }

        return components;
    };

    // chatbotì¶”ê°€ (í•˜ë‚˜)
    const [chatboxVisible, setChatboxVisible] = useState(false);

    useEffect(function () {
        getAllBlogs();
        // if(inView) {
        //   console.log(inView, " ë¬´í•œ ìŠ¤í¬ë¡¤ ìš”ì²­");
        //   productFetch();
        // }
    }, []);

    const [currentTab, clickTab] = useState(0);

    const menuArr = [
        { name: 'Tab1', content: 'Tab menu ONE' },
        { name: 'Tab2', content: 'Tab menu TWO' },
        { name: 'Tab3', content: 'Tab menu THREE' },
    ];

    const selectMenuHandler = (index) => {
        // parameterë¡œ í˜„ì¬ ì„ íƒí•œ ì¸ë±ìŠ¤ ê°’ì„ ì „ë‹¬í•´ì•¼ í•˜ë©°, ì´ë²¤íŠ¸ ê°ì²´(event)ëŠ” ì“°ì§€ ì•ŠëŠ”ë‹¤
        // í•´ë‹¹ í•¨ìˆ˜ê°€ ì‹¤í–‰ë˜ë©´ í˜„ì¬ ì„ íƒëœ Tab Menu ê°€ ê°±ì‹ .
        clickTab(index);
    };

    return (
        <SearchResultContainer>
            <div className="mainWrap">
                <div className="slideWrap">
                <Swiper
                spaceBetween={50}
                slidesPerView={1}
                scrollbar={{ draggable: true }}
                navigation
                pagination={{ clickable: true }}
                loop= {true}
                //   breakpoints={{
                //     768: {
                //       slidesPerView: 7,
                //     },
                //   }}
                >
                <SwiperSlide><img src={banner1} alt="" /></SwiperSlide>
                <SwiperSlide><img src={banner2} alt="" /></SwiperSlide>
                <SwiperSlide><img src={banner3} alt="" /></SwiperSlide>
                ...
                </Swiper>
                </div>

                <div className="blogWrap">
                    <div className='blog_txt'>
                        <h3>ê¸ˆì£¼ì˜ Hot Blog ğŸ”¥</h3>
                        <a href="http://localhost:3000/blog">More Blog {'>'}</a>
                    </div>

                    <div className="blog_list">
                        {blogList.length > 0 ? (
                            printRows(blogList)
                        ) : (
                            // searchResultì˜ ê²°ê³¼ê°€ 0ê°œì¼ë•Œ
                            <>
                                <h1> ê²Œì‹œë¬¼ì´ ì—†ìŠµë‹ˆë‹¤. </h1>                                                                      
                            </>  
                        )}
                    </div>
                </div>

                <div className="lectureWrap">
                <div className="lec_txt">
                    <p>ê°•ì˜ìƒµ</p>
                    <h3>ë¬´ì—‡ì„ ë” ê³µë¶€í•˜ë©´<br/>ì¢‹ì„ì§€ ê³ ë¯¼ì´ì‹ ê°€ìš”?</h3>
                    <a href="#">ë”ë³´ê¸° {'>'}</a>
                </div>
                <div className="lec_right">
                    {/* <div className="lec_menu">
                        <ul>
                            <li onclick="activateTab('tab1')">ë°±ì—”ë“œ</li>
                            <li onclick="activateTab('tab2')">í”„ë¡ íŠ¸ì—”ë“œ</li>
                            <li onclick="activateTab('tab3')">ë°ì´í„°/ë¨¸ì‹ ëŸ¬ë‹</li>
                        </ul>
                    </div>
                    <div class="tabContent">
                        <div id="tab1" class="tabPane active">
                        <h3>Tab 1 Content</h3>
                        <p>This is the content for Tab 1.</p>
                        </div>

                        <div id="tab2" class="tabPane">
                        <h3>Tab 2 Content</h3>
                        <p>This is the content for Tab 2.</p>
                        </div>

                        <div id="tab3" class="tabPane">
                        <h3>Tab 3 Content</h3>
                        <p>This is the content for Tab 3.</p>
                        </div>
                    </div> */}
                    <TabMenu>
                    // ì•„ë˜ í•˜ë“œì½”ë”©ëœ ë‚´ìš© ëŒ€ì‹ ì—, mapì„ ì´ìš©í•œ ë°˜ë³µìœ¼ë¡œ ì½”ë“œë¥¼ ìˆ˜ì •
                    // li ì—˜ë¦¬ë¨¼íŠ¸ì˜ classëª…ì˜ ê²½ìš° ì„ íƒëœ tab ì€ 'submenu focused', ë‚˜ë¨¸ì§€ 2ê°œì˜ tabì€ 'submenu' 
                    {/* <li className="submenu">{menuArr[0].name}</li>
                    <li className="submenu">{menuArr[1].name}</li>
                    <li className="submenu">{menuArr[2].name}</li> */}
                    {menuArr.map((el,index) => (
                        <li className={index === currentTab ? "submenu focused" : "submenu" }
                        onClick={() => selectMenuHandler(index)}>{el.name}</li>
                        ))}
                    </TabMenu>
                    <Desc>
                    <p>{menuArr[currentTab].content}</p>
                    </Desc>
                    
                </div>
                </div>

                <div className="job">
                    <h3>ì±„ìš©ê³µê³ </h3>
                    <p>ì§€ì›í•˜ê³ ì‹¶ì€ ê³µê³ ë¥¼ ì°¾ì•„ë³´ì„¸ìš”</p>
                    <div className="job_list">
                        <ul>
                            <li><a href="#">
                                <article><img src={job1} alt="" /></article>
                                <p>ì¬íƒê·¼ë¬´</p>
                            </a></li>
                            <li><a href="#">
                                <article><img src={job2} alt="" /></article>
                                <p>ì¸ì„¼í‹°ë¸Œ</p>
                            </a></li>
                            <li><a href="#">
                                <article><img src={job3} alt="" /></article>
                                <p>ìœ ì—°ê·¼ë¬´ì œ</p>
                            </a></li>
                            <li><a href="#">
                                <article><img src={job4} alt="" /></article>
                                <p>ì‹ ì…ì—°ë´‰ 4ì²œì´ìƒ</p>
                            </a></li>
                        </ul>
                    </div>
                </div>
            </div>

            <Chatbox isVisible={chatboxVisible} />
            {chatboxVisible && (
                <ChatboxContainer>
                    <Chatbox />
                </ChatboxContainer>
            )}
        </SearchResultContainer>
    );
};

export default Main;
